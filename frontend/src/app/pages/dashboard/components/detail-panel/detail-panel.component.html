<aside
  [class.translate-x-[calc(100%+2rem)]]="!fence"
  [class.opacity-0]="!fence"
  class="flex flex-col h-full bg-slate-900/95 backdrop-blur-xl border border-slate-700/50 rounded-3xl shadow-2xl transition-all duration-500 pointer-events-auto overflow-hidden font-sans"
>
  @if (fence && editData) {
    <div class="p-6 border-b border-slate-800 flex justify-between items-center">
      <div>
        <h3 class="text-xl font-bold text-white tracking-tight">Geofence Details</h3>
        <p
          class="text-[10px] text-slate-500 uppercase font-black tracking-widest leading-none mt-1"
        >
          ID: {{ fence.id }}
        </p>
      </div>
      <button
        (click)="closed.emit()"
        class="p-2 hover:bg-slate-800 rounded-full text-slate-400 transition-colors"
      >
        ✕
      </button>
    </div>
    <div class="flex-grow overflow-y-auto p-6 space-y-8 custom-scrollbar">
      <div class="space-y-2">
        <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1"
          >Name</label
        >
        <input
          type="text"
          [(ngModel)]="editData.name"
          [disabled]="!isEditing"
          class="w-full bg-slate-800/50 border border-slate-700 rounded-2xl px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none transition-all disabled:opacity-50 disabled:bg-transparent"
        />
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div class="space-y-2">
          <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1"
            >Category</label
          >
          <input
            type="text"
            [(ngModel)]="editData.metadata.category"
            [disabled]="!isEditing"
            class="w-full bg-slate-800/50 border border-slate-700 rounded-2xl px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none transition-all disabled:opacity-50 disabled:bg-transparent"
          />
        </div>
        <div class="space-y-2">
          <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1"
            >Color</label
          >
          <input
            type="color"
            [(ngModel)]="editData.metadata.color"
            [disabled]="!isEditing"
            class="w-full h-[46px] bg-slate-800/50 border border-slate-700 rounded-2xl p-1 cursor-pointer disabled:opacity-30"
          />
        </div>
      </div>
      <div
        class="p-5 border rounded-3xl transition-all"
        [class]="{
          'bg-indigo-600/10 border-indigo-500/50': isEditing,
          'bg-slate-800/20 border-slate-700/50': !isEditing,
        }"
      >
        <div class="flex items-center gap-3">
          <span
            class="text-xl"
            [class.text-indigo-400]="isEditing"
            [class.text-slate-500]="!isEditing"
            >⬠</span
          >
          <div class="flex flex-col">
            <span
              class="text-xs font-bold"
              [class.text-white]="isEditing"
              [class.text-slate-400]="!isEditing"
              >Perimeter Edit</span
            >
            <span
              class="text-[10px]"
              [class.text-indigo-300]="isEditing"
              [class.text-slate-600]="!isEditing"
            >
              {{ isEditing ? 'Map editing active' : 'Map locked' }}
            </span>
          </div>
        </div>
      </div>
    </div>
    <div class="p-6 bg-slate-900/50 border-t border-slate-800 flex gap-3">
      @if (isEditing) {
        <button
          (click)="cancelEdit()"
          class="flex-1 py-4 text-slate-400 font-bold hover:text-white transition-colors"
        >
          Cancel
        </button>
        <button
          (click)="onSave()"
          class="flex-[2] py-4 bg-emerald-600 text-white font-bold rounded-2xl shadow-lg hover:bg-emerald-500 transition-all"
        >
          Confirm
        </button>
      } @else {
        <button
          (click)="deleted.emit(fence.id)"
          class="p-4 bg-red-500/10 text-red-500 rounded-2xl border border-red-500/20 hover:bg-red-500 hover:text-white transition-all"
        >
          Delete
        </button>
        <button
          (click)="startEdit()"
          class="flex-grow py-4 bg-indigo-600 text-white font-bold rounded-2xl shadow-lg hover:bg-indigo-500 transition-all flex items-center justify-center gap-2"
        >
          Edit Geofence
        </button>
      }
    </div>
  }
</aside>
